# JWT 認証 について説明できる

認証（ログイン）は多くのウェブアプリケーションで必要とされる機能です。

認証を実現するのに一般的に使用されるのが、JWT 認証です。

## 1. 認証とは

認証とは何か、プログラミング初心者にわかるように説明してください。

→
認証（authentication）は利用者本人の確認を行うこと。
ちなみに認可（authorization）は利用者に正しい権限を与えること。

## 2. 認証の方法

認証には様々な方法があります。どのような方法があるかを調べ、有名なものを3つ挙げ、その方法及びメリット・デメリットを説明してください。

- ベーシック認証
IDとパスワードをBase64でエンコードして、HTTPヘッダのAuthorizationフィールドに記載しサーバーに送信する方法。
実装が用意で、ほぼすべてのWebサーバおよびブラウザで対応しているため、簡易的な認証として広く使われている。しかし、IDとパスワードをBase64でエンコードして送信するため、盗聴すれば簡単にIDとパスワードが流出してしまう。

- ダイジェスト認証
サーバが生成したランダムな文字列をパスワードに付与し、IDとパスワードをMD5でハッシュ化してから送信するため、盗聴されてもパスワードの解析は困難。

- セッションベースの認証
サーバはクライアントにランダムな値のセッションIDを送信（セッションIDはクッキーに保存）
サーバーはセッションIDと紐づけることでクライアントの状態を保持できるため、認証が成功すれば、その後はセッションIDの確認だけで認証が不要になる。通信のたびにユーザー名とパスワードを送るのはハッキングを受ける確率も増え、毎回認証のオーバーヘッドも大きくなる。
ただし、Cookieをリクエスト毎に送信する必要があるため、クロスサイトフォージェリにあうリスクは高い。

## 3. JWT とは

認証の中でも API においてよく使用されるのが JWT 認証です。
JWT とは何か、プログラミング初心者にわかるように説明してください。

→

JSON Web Token(JWT) は、JSON ベースのデータを暗号化してつくられる文字列で、認証や認可のための仕組みとして Web アプリケーションなどで用いられる技術。

JWT では 公開鍵を利用してクライアント側で トークンの正当性を確認できるという特徴があります。
トークンはオフラインで正当性が保証されるため、逆に一度発行したトークンが困難であるというデメリットも存在します。

また通常のトークンがそれ自体では全く意味を持たないケースがほとんどであるのに対して、JWT はそれ自体が情報を持つトークン。このため JWT の内部に 個人情報などを含めることは推奨されない。

セッションベースの認証におけるCookieの代わりに、トークンを利用する方法。そのトークンで一般的に使用されるのがJWT。
以下のような構成で作成される。

```
ヘッダー: 署名の検証に必要な情報
ペイロード: やり取りに必要な情報。ユーザー情報など
署名:検証する内容
```
これらを、`{ヘッダ}.{ペイロード}.{署名}`の形式で構成される。
例えば、こんな感じ。
```
eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.SflKxwRJSMeKKF2QT4fwpMeJf36POk6yJV_adQssw5c
```

## 4. JWT 認証の流れ

JWT を用いた認証の流れ（どのような流れで認証が行われるのか）を説明してください。その際に、JWT 認証の流れを図 (シーケンス図) にもまとめてください。

サーバ側でjwtを発行し、Authorizationヘッダーを使って受け渡しを行う。
jwtはクライアント側の、

- OS標準のストレージ：iOSのKeyChain、AndroidのKeyStore
- メモリ：JavaScriptの変数など
- Cookie：WebブラウザのCookie
- localStorage：Web Storage APIのlocalStorage

に保存される。以降リクエストがあったとき、jwtをサーバー側の秘密鍵で復号化し認証をおこなう。
ログイン状態は、jwtを持っているかどうかで判断でき、有効期限が切れるとjwtは消滅する。

## 5. JWT 認証のメリット・デメリット

JWT を用いた認証のメリット、デメリットを挙げてください。

メリット
クライアントから送信されるJWTはサーバで秘密鍵を使って改ざんが行われたかを検証する為、`user_id`や`exp`の改ざんを検知する事ができる。
トークン単体でデータを含むため、サーバーでのデータ参照が不要なステートレスな認証が実現できる。

デメリット
 一度発行したJWTの無効化は難しい。有効時間が終わらない限り残る。
 JWT の中身は Base64 エンコードされただけなのでクライアント側から中身が簡単に確認できる。
 